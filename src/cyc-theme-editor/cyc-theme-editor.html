<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">

<dom-module id="cyc-theme-editor">
  <template>
    <link rel="stylesheet" href="cyc-theme-editor.css" inline>

    <form class="form" on-change="_enableSubmit" on-reset="_onFormReset">
      <fieldset>
        <legend>
          <span>Editor Colors</span>
        </legend>

        <ul class="group-list">
          <template is="dom-repeat" items="[[editorColors]]" id="editorColorsList">
            <li>
              <label class="color-field">
                <span class="label">[[item.name]]</span>
                <span class="input-wrapper">
                  <input type="color" name="[[item.prop]]" value="[[item.value]]" data-css-var$="[[item.cssVar]]" on-input="_updateCSSVars">
                </span>
              </label>
            </li>
          </template>
        </ul>
      </fieldset>

      <div class="form-actions">
        <button class="btn btn--secondary" type="reset">It's awful!</button>
        <button class="btn btn--primary" type="submit" disabled="[[!_formChanged]]">Download theme</button>
      </div>
    </form>
  </template>

  <script>
    class CycThemeEditor extends Polymer.Element {
      static get is() {
        return 'cyc-theme-editor';
      }

      static get properties() {
        return {
          editorColors: {
            type: Array,
            value: function() {
              return [{
                name: 'TitleBar background',
                prop: 'titleBar.activeBackground',
                value: '#141820',
                cssVar: '--bg-titleBar'
              }, {
                name: 'ActivityBar background',
                prop: 'activityBar.background',
                value: '#1C212E',
                cssVar: '--bg-activityBar'
              }, {
                name: 'Sidebar background',
                prop: 'sideBar.background',
                value: '#1C212E',
                cssVar: '--bg-sidebar'
              }]
            }
          },
          _formChanged: {
            type: Boolean,
            value: false
          }
        };
      }

      _updateCSSVars(e) {
        const { dataset: { cssVar }, value } = e.target;
        document.documentElement.style.setProperty(cssVar, value);
      }

      _onFormReset() {
        this._formChanged = false;
        document.documentElement.removeAttribute('style');
      }

      _enableSubmit() {
        this._formChanged = true;
      }
    }

    window.customElements.define(CycThemeEditor.is, CycThemeEditor);
  </script>
</dom-module>
